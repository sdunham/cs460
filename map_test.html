<!doctype html>
<html>
	<head>
		
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		
		<title>Puget Sound Security Incident Visualization</title>
		
		<!-- Google Chrome Frame for IE -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		
		<!-- mobile meta (hooray!) -->
		<!-- <meta name="HandheldFriendly" content="True"> -->
		<!-- <meta name="MobileOptimized" content="320"> -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<!-- <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" /> -->
		<link rel="stylesheet" type="text/css" href="css/cs460-theme/jquery-ui-1.9.2.custom.min.css" />

		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.css" />
		<!--[if lte IE 8]>
			<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.ie.css" />
		<![endif]-->
		<script src="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.js"></script>
		
		<link rel="stylesheet" type="text/css" href="style.css" />
		
		<!-- D3 Visualization Stuff -->
		<!-- <script src="http://d3js.org/d3.v2.js"></script> -->
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script type="text/javascript" src="smartResize/smartResize.js"></script>
		<!-- <script type="text/javascript" src="enquire/enquire.min.js"></script> -->
		<!-- <script src="http://code.highcharts.com/highcharts.js"></script> -->
		<script>
			//Load the Visualization API and the piechart package.
			google.load('visualization', '1.0', {'packages':['corechart']});
			var chart;
			var genChart = function(pieData){
				if($(".graph-toggle").hasClass("shown")){
					//console.log(pieData);
					$("#graph").empty();
					var options = {
						backgroundColor: "transparent",
						pieSliceBorderColor: "transparent",
						chartArea:{top:20},
						//colors: ["B52A2C","B56D2A","B5B22A","72B52A","2CB52A","2AB56D","2AB5B2","2A72B5","2A2CB5","6D2AB5","B22AB5","B52A72","A7988B","333333","000000"],
						//chartArea:{top:20, width:"100%"},
						sliceVisibilityThreshold:1/180,
						legend: {position: "bottom", textStyle: {color: "white", fontSize: 12}}
					};
					//Create and populate the data table.
					var data = google.visualization.arrayToDataTable(pieData,true);
					//Create and draw the visualization.
					chart = new google.visualization.PieChart(document.getElementById('graph'));
					function selectHandler() {
						var selectedItem = chart.getSelection()[0];
						if (selectedItem) {
							var incidentCat = data.getValue(selectedItem.row, 0);
							//alert('The user selected ' + incidentCat);
						}
					}

					google.visualization.events.addListener(chart, 'select', selectHandler); 
					
					chart.draw(data,options);
				}
			};
			
			$(window).smartresize(function(){  
				genChart(processedChartData);
				console.log("Window resized!");
			});
			
			//Enquire script to only automatically fire the genChart function when the mobile version kicks in
			/*enquire.register("screen and (min-width: 1030px)", {
				match : function() {genChart(processedChartData);},
				unmatch : function() {genChart(processedChartData);}
			}).listen();*/
		</script>
		
		<!-- Date Slider -->
		<!-- <link rel="stylesheet" id="dateCSS" href="jQRangeSlider-min/css/classic.css"> 
		<script src="jQRangeSlider-min/jQAllRangeSliders-min.js"></script> -->
		<script>
			$(function() {
				//$("#date").dateRangeSlider({/*options*/});
				$("#datepicker-start").datepicker({
					changeYear: true,
					dateFormat: "yy-mm-dd",
					onClose: function( selectedDate ) {
						$("#datepicker-end").datepicker( "option", "minDate", selectedDate );
					}
				});
				$("#datepicker-end").datepicker({
					changeYear: true,
					dateFormat: "yy-mm-dd",
					onClose: function( selectedDate ) {
						$("#datepicker-start").datepicker( "option", "maxDate", selectedDate );
					}
				});
				$("#datepicker-start").datepicker("setDate", "-4m");
				$("#datepicker-end").datepicker("setDate", new Date());
			});
		</script>
		
		<!-- Time Picker -->
		<link rel="stylesheet" type="text/css" href="timepicker/jquery.ui.timepicker.css" />
		<script type="text/javascript" src="timepicker/jquery.ui.timepicker.js"></script>
		<!-- <script type="text/javascript" src="jquery-ui-timeslider/jquery.ui.timeslider.js"></script> -->
		<script>
			function timepickerValidate(){
				var startVal = $('#timepicker-start').timepicker("getTime");
				startVal = (startVal == "Missing instance data for this timepicker") ? "" : startVal;
				var startTime = startVal.replace(":","");
				var endVal = $('#timepicker-end').timepicker("getTime");
				endVal = (endVal == "Missing instance data for this timepicker") ? "" : endVal;
				var endTime = endVal.replace(":","");
				if(startVal != "" && endVal != "" && startTime > endTime){
					$('#timepicker-start').timepicker("setTime",endVal);
					$('#timepicker-end').timepicker("setTime",startVal);
				}
			}
			$(function() {
				$('#timepicker-start').timepicker({
					showLeadingZero: true,
					timeSeparator: ':',
					//onHourShow: tpStartOnHourShowCallback,
					//onMinuteShow: tpStartOnMinuteShowCallback,
					onClose: timepickerValidate,
					hours: {
						starts: 0,                // First displayed hour
						ends: 23                  // Last displayed hour
					},
					minutes: {
						starts: 0,                // First displayed minute
						ends: 59,                 // Last displayed minute
						interval: 1               // Interval of displayed minutes
					},
					rows: 6,                      // Number of rows for the input tables, minimum 2, makes more sense if you use multiple of 2

					// buttons
					showCloseButton: true,       // shows an OK button to confirm the edit
					closeButtonText: 'Done',      // Text for the confirmation button (ok button)
					showNowButton: false,         // Shows the 'now' button
					showDeselectButton: true,    // Shows the deselect time button
					deselectButtonText: 'Clear' // Text for the deselect button
				});
				$('#timepicker-end').timepicker({
					showLeadingZero: true,
					timeSeparator: ':',
					//onHourShow: tpEndOnHourShowCallback,
					//onMinuteShow: tpEndOnMinuteShowCallback,
					onClose: timepickerValidate,
					hours: {
						starts: 0,                // First displayed hour
						ends: 23                  // Last displayed hour
					},
					minutes: {
						starts: 0,                // First displayed minute
						ends: 59,                 // Last displayed minute
						interval: 1               // Interval of displayed minutes
					},
					rows: 6,                      // Number of rows for the input tables, minimum 2, makes more sense if you use multiple of 2

					// buttons
					showCloseButton: true,       // shows an OK button to confirm the edit
					closeButtonText: 'Done',      // Text for the confirmation button (ok button)
					showNowButton: false,         // Shows the 'now' button
					showDeselectButton: true,    // Shows the deselect time button
					deselectButtonText: 'Clear' // Text for the deselect button
				});
			});
		</script>
		
		<!-- Marker Cluster Plugin -->
		<link rel="stylesheet" href="Leaflet.markercluster/dist/MarkerCluster.css" />
		<link rel="stylesheet" href="Leaflet.markercluster/dist/MarkerCluster.Default.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="Leaflet.markercluster/dist/MarkerCluster.Default.ie.css" /><![endif]-->
		<script type="text/javascript" src="Leaflet.markercluster/dist/leaflet.markercluster-src.js"></script>
		<script>
			//Generic incident icon class
			var IncidentIcon = L.Icon.extend({
				options: {
					iconSize:     [35, 35], // size of the icon
					iconAnchor:   [17.5, 27], // point of the icon which will correspond to marker's location
					popupAnchor:  [0, -23] // point from which the popup should open relative to the iconAnchor
				}
			});
			
			//Individual icons for each Clery category
			var liquorIcon = new IncidentIcon({iconUrl: 'icons/PNGs/liquor.png'});
			var robberyIcon = new IncidentIcon({iconUrl: 'icons/PNGs/robbery.png'});
			var assaultIcon = new IncidentIcon({iconUrl: 'icons/PNGs/assault.png'});
			var burglaryIcon = new IncidentIcon({iconUrl: 'icons/PNGs/burglary.png'});
			var murderIcon = new IncidentIcon({iconUrl: 'icons/PNGs/murder.png'});
			var carTheftIcon = new IncidentIcon({iconUrl: 'icons/PNGs/car.png', iconAnchor: [17.5, 20]});
			var drugIcon = new IncidentIcon({iconUrl: 'icons/PNGs/drugs.png'});
			var weaponIcon = new IncidentIcon({iconUrl: 'icons/PNGs/gun.png', iconAnchor: [17.5, 17]});
			var theftIcon = new IncidentIcon({iconUrl: 'icons/PNGs/pickpocket.png', iconAnchor: [24.5, 27]});
			var vandalismIcon = new IncidentIcon({iconUrl: 'icons/PNGs/vandalism.png'});
			var sexOffenseIcon = new IncidentIcon({iconUrl: 'icons/PNGs/sexoffense.png'});
			var attemptedCrimeIcon = new IncidentIcon({iconUrl: 'icons/PNGs/arrest.png'});
			var manslaughterIcon = new IncidentIcon({iconUrl: 'icons/PNGs/manslaughter.png'});
			var unknownIcon = new IncidentIcon({iconUrl: 'icons/PNGs/unknown.png'});
			
			/*var liquorIcon = new IncidentIcon({iconUrl: 'icons/liquor.svg'});
			var robberyIcon = new IncidentIcon({iconUrl: 'icons/robbery.svg'});
			var assaultIcon = new IncidentIcon({iconUrl: 'icons/assault.svg'});
			var burglaryIcon = new IncidentIcon({iconUrl: 'icons/burglary.svg'});
			var murderIcon = new IncidentIcon({iconUrl: 'icons/murder.svg'});
			var carTheftIcon = new IncidentIcon({iconUrl: 'icons/car.svg', iconAnchor: [17.5, 20]});
			var drugIcon = new IncidentIcon({iconUrl: 'icons/drugs.svg'});
			var weaponIcon = new IncidentIcon({iconUrl: 'icons/gun.svg', iconAnchor: [17.5, 17]});
			var theftIcon = new IncidentIcon({iconUrl: 'icons/pickpocket.svg', iconAnchor: [24.5, 27]});
			var vandalismIcon = new IncidentIcon({iconUrl: 'icons/vandalism.svg'});
			var sexOffenseIcon = new IncidentIcon({iconUrl: 'icons/sexoffense.svg'});
			var attemptedCrimeIcon = new IncidentIcon({iconUrl: 'icons/arrest.svg'});
			var manslaughterIcon = new IncidentIcon({iconUrl: 'icons/manslaughter.svg'});
			var unknownIcon = new IncidentIcon({iconUrl: 'icons/unknown.svg'});*/
			
			/*var liquorIcon = new IncidentIcon({iconUrl: 'icons/PNGs/liquor.png', iconSize: [20,27], iconAnchor: [9.5,20]});
			var robberyIcon = new IncidentIcon({iconUrl: 'icons/PNGs/robbery.png', iconSize: [35,30]});
			var assaultIcon = new IncidentIcon({iconUrl: 'icons/PNGs/assault.png', iconSize: [33,35], iconAnchor: [7.5,6]});
			var burglaryIcon = new IncidentIcon({iconUrl: 'icons/PNGs/burglary.png', iconSize: [21,35], iconAnchor: [11.5,26]});
			var murderIcon = new IncidentIcon({iconUrl: 'icons/PNGs/murder.png', iconSize: [30,35], iconAnchor: [15.5,20]});
			var carTheftIcon = new IncidentIcon({iconUrl: 'icons/PNGs/car.png', iconSize: [40,15], iconAnchor: [13.5,8]});
			var drugIcon = new IncidentIcon({iconUrl: 'icons/PNGs/drugs.png', iconSize: [34,35], iconAnchor: [8.5,12]});
			var weaponIcon = new IncidentIcon({iconUrl: 'icons/PNGs/gun.png', iconSize: [40,26], iconAnchor: [35.5,14]});
			var theftIcon = new IncidentIcon({iconUrl: 'icons/PNGs/pickpocket.png', iconSize: [28,35], iconAnchor: [18.5,25]});
			var vandalismIcon = new IncidentIcon({iconUrl: 'icons/PNGs/vandalism.png', iconSize: [19,35], iconAnchor: [5.5,22]});
			var sexOffenseIcon = new IncidentIcon({iconUrl: 'icons/PNGs/sexoffense.png', iconSize: [35,35], iconAnchor: [20.5,36]});
			var attemptedCrimeIcon = new IncidentIcon({iconUrl: 'icons/PNGs/arrest.png', iconSize: [43,35], iconAnchor: [19.5,2]});
			var manslaughterIcon = new IncidentIcon({iconUrl: 'icons/PNGs/manslaughter.png', iconSize: [33,35], iconAnchor: [32.5,22]});
			var unknownIcon = new IncidentIcon({iconUrl: 'icons/PNGs/unknown.png', iconSize: [18,30], iconAnchor: [7.5,20]});*/
			
			var incidentPopupTemplate = "<div><h3 class='incidentID'>Incident # </h3><div class='popupField'><span class='popupLabel'>Type:</span><span class='popupType'></span></div><div class='popupField'><span class='popupLabel'>Location:</span><span class='popupLoc'></span></div><div class='popupField'><span class='popupLabel'>Date:</span><span class='popupDate'></span></div><div class='popupField'><span class='popupLabel'>Time:</span><span class='popupTime'></span></div></div>";
			
			var resetData = function(){
				var newObj = {
					"AGGRAVATED ASSAULT":0,
					"ATTEMPTED CRIME":0,
					"BURGLARY":0,
					"DRUG ABUSE VIOLATIONS":0,
					"LIQUOR LAW VIOLATIONS":0,
					"MOTOR VEHICLE THEFT":0,
					"MURDER / NON-NEGLIGENT MANSLAUGHTER":0,
					"NEGLIGENT MANSLAUGHTER":0,
					"ROBBERY":0,
					"SEX OFFENSE - FORCIBLE":0,
					"SEX OFFENSE - NON-FORCIBLE":0,
					"THEFT":0,
					"UNKNOWN":0,
					"VANDALISM":0,
					"WEAPON VIOLATIONS":0
				};
				return newObj;
			};
			
			var chartData = resetData(); //Raw chart data
			var processedChartData = []; //Processed chart data used by the genChart function
			
			//Custom info control for map
			var infoControl = L.Control.extend({
				options: {
					position: 'topleft'
				},
				onAdd: function (map) {
					var className = 'vis-control-info',
						container = L.DomUtil.create('div', className);
					this._map = map;
					this._infoButton = this._createButton('','More information', className + '-button',container,this._showInfo,this);
					return container;
				},

				_showInfo: function (e) {
					var dialogWidth = $(window).width();
					var dialogHeight = $(window).height();
					if(dialogWidth <= 650){dialogWidth = dialogWidth * 0.9;}
					else{dialogWidth = 625;}
					if(dialogHeight <= 500){dialogHeight = dialogHeight * 0.9;}
					else{dialogHeight = 400;}
					$("#info-modal").dialog("option","width",dialogWidth);
					$("#info-modal").dialog("option","height",dialogHeight);
					$("#info-modal").dialog("open");
				},

				_createButton: function (html, title, className, container, fn, context) {
					var link = L.DomUtil.create('a', className, container);
					link.innerHTML = html;
					link.href = '#';
					link.title = title;

					L.DomEvent
						.on(link,'click',L.DomEvent.stopPropagation)
						.on(link,'mousedown',L.DomEvent.stopPropagation)
						.on(link,'dblclick',L.DomEvent.stopPropagation)
						.on(link,'click',L.DomEvent.preventDefault)
						.on(link,'click',fn,context);
					return link;
				}
			});
			
			$(function() {
				// create a map in the "map" div, set the view to a given place and zoom
				var map = L.map('map').setView([47.261743,-122.481775], 16);
				var markers; //Global variable to hold the markers
				
				// add a CloudMade tile layer with style #997
				L.tileLayer('http://{s}.tile.cloudmade.com/eac20f969c234bed8c6e3191bbac3bfc/997/256/{z}/{x}/{y}.png', {
					attribution: 'Map data &copy; <a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a>'
				}).addTo(map);
				
				//Function which queries the database based on current filter selections
				var genIncidentMarkers = function(){
					var dataVal, beginDateVal, endDateVal, beginTimeVal, endTimeVal, typeVals;
					dataVal = $("input:radio[name='data']:checked").val();
					beginDateVal = $("input[name='datepicker-start']").val();
					endDateVal = $("input[name='datepicker-end']").val();
					beginTimeVal = $("input[name='timepicker-start']").val();
					endTimeVal = $("input[name='timepicker-end']").val();
					typeVals = $("#incident-select").val();
					chartData = resetData();
					processedChartData = [];
					$.ajax({
						type: "POST",
						url: "db_select_records_json.php",
						data: {
							data: dataVal,
							beginDate: beginDateVal,
							endDate: endDateVal,
							beginTime: beginTimeVal,
							endTime: endTimeVal,
							type: typeVals
						}
					}).done(function(data) {
						var incidents = jQuery.makeArray(data.incidents);
						if(typeof markers !== "undefined"){markers.clearLayers();}
						markers = new L.MarkerClusterGroup();
						$.each(incidents, function() {
							var curID, curLat, curLong, curType, curDate, curTime, curLoc, curMarker, curPopup, curIcon;
							curID = this.ID;
							curLat = this.lat;
							curLong = this.long;
							curType = this.type;
							curDate = this.date;
							curTime = this.time;
							curLoc = this.location;
							curPopup = $(incidentPopupTemplate); //Create an empty popup template to manipulate
							curPopup.find(".incidentID").append(curID);
							curPopup.find(".popupType").html(curType);
							curPopup.find(".popupLoc").html(curLoc);
							curPopup.find(".popupDate").html(curDate);
							curPopup.find(".popupTime").html(curTime);
							//Assign icon based on current incident's type
							switch(curType.toUpperCase()){
								case "AGGRAVATED ASSAULT":
								curIcon = assaultIcon;
								break;
								case "BURGLARY":
								curIcon = burglaryIcon;
								break;
								case "MURDER / NON-NEGLIGENT MANSLAUGHTER":
								curIcon = murderIcon;
								break;
								case "NEGLIGENT MANSLAUGHTER":
								curIcon = manslaughterIcon;
								break;
								case "MOTOR VEHICLE THEFT":
								curIcon = carTheftIcon;
								break;
								case "ROBBERY":
								curIcon = robberyIcon;
								break;
								case "SEX OFFENSE - NON-FORCIBLE":
								curIcon = sexOffenseIcon;
								break;
								case "SEX OFFENSE - FORCIBLE":
								curIcon = sexOffenseIcon;
								break;
								case "LIQUOR LAW VIOLATIONS":
								curIcon = liquorIcon;
								break;
								case "DRUG ABUSE VIOLATIONS":
								curIcon = drugIcon;
								break;
								case "WEAPON VIOLATIONS":
								curIcon = weaponIcon;
								break;
								case "THEFT":
								curIcon = theftIcon;
								break;
								case "ATTEMPTED CRIME":
								curIcon = attemptedCrimeIcon;
								break;
								case "VANDALISM":
								curIcon = vandalismIcon;
								break;
								default:
								curIcon = unknownIcon;
							}
							curMarker = new L.marker([curLat, curLong], {icon: curIcon});
							curMarker.bindPopup(curPopup.html(),{maxWidth:350});
							markers.addLayer(curMarker);							
							
							if(chartData.hasOwnProperty(this.type)){
								chartData[this.type] += 1;
							}
							else{
								chartData[this.type] = 1;
							}
						});
						map.addLayer(markers);
						if(dataVal == "fake"){
							$("#fake-warn").dialog({title:"<center>Alert:</center>", height:65});
						}
						$.each(chartData, function(name,value){
							var cur = [name,value];
							processedChartData.push(cur);
						});
						processedChartData.sort(function(a,b){
							if (a[0] < b[0]){return -1;}
							else if (a[0] > b[0]){return 1;}
							else{return 0;}
						});
						genChart(processedChartData);
					});
				};
				
				//Prepare "More Information" modal dialog
				$("#info-modal").dialog({
					modal: true,
					autoOpen: false,
					open: function(){
						$("#info-sections").show();
						$("#info-sections").accordion({ collapsible:true, active:0, heightStyle:"content" });
					}
				});
				
				//Prepare Real/Fake jQuery UI button set
				$("#data-radios").buttonset();
				
				//Prepare Submit jQuery UI button
				$("input[value='Submit']").button();
				
				//Add custom info button to map
				map.addControl(new infoControl());
				
				//Query the database based on the current filter selections to generate markers
				genIncidentMarkers();

				//Bind click event to filter toggle
				$(".filter-toggle").click(function(){
					$("#filters").slideToggle();
					$(this).toggleClass("shown");
				});
				
				//Bind click event to filter toggle
				$(".graph-toggle").click(function(){
					$("#graph").toggle("fast", function(){
						$(".graph-toggle").toggleClass("shown");
						genChart(processedChartData);
					});
				});
				
				//Bind click event to clicking submit button
				$("input[value='Submit']").click(function () {
					//Query the database based on the current filter selections to generate markers
					genIncidentMarkers();
				});
			});
		</script>
	</head>
	<body>
		<aside id="fake-warn" style="display:none;">
			<p style="text-align:center; margin:0;">You are currently viewing fake data!</p>
		</aside>
		<aside id="controls">
			<h2 class="filter-toggle">Filter Incident Data</h2>
			<div id="filters">
				<div class="filter-field">
					<label for="data-radios">Data set:</label>
					<span id="data-radios">
						<input type="radio" name="data" value="real" checked="checked" id="realDB"><label for="realDB">Real</label>
						<input type="radio" name="data" value="fake" id="fakeDB"><label for="fakeDB">Fake</label>
					</span>
				</div>
				<div class="filter-field">
					<label for="datepicker-start">Date Range:</label>
					<input type="text" name="datepicker-start" id="datepicker-start"> to
					<input type="text" name="datepicker-end" id="datepicker-end">
				</div>
				<div class="filter-field">
					<label for="timepicker-start">Time Range:</label>
					<input type="text" name="timepicker-start" id="timepicker-start" value="00:00"> to
					<input type="text" name="timepicker-end" id="timepicker-end" value="23:59">
				</div>
				<div class="filter-field">
					<label for="incident-select">Type(s):</label>
					<select multiple="multiple" name="incident-select" id="incident-select" title="Hold ctrl while clicking to select multiple types">
						<option disabled="disabled">Select Type(s):</option>
						<option selected="selected" value="'AGGRAVATED ASSAULT'">Aggravated Assault</option>
						<option selected="selected" value="'ATTEMPTED CRIME'">Attempted Crime</option>
						<option selected="selected" value="'BURGLARY'">Burglary</option>
						<option selected="selected" value="'DRUG ABUSE VIOLATIONS'">Drug Abuse Violations</option>
						<option selected="selected" value="'LIQUOR LAW VIOLATIONS'">Liquor Law Violations</option>
						<option selected="selected" value="'MOTOR VEHICLE THEFT'">Motor Vehicle Theft</option>
						<option selected="selected" value="'MURDER / NON-NEGLIGENT MANSLAUGHTER'">Murder</option>
						<option selected="selected" value="'NEGLIGENT MANSLAUGHTER'">Negligent Manslaughter</option>
						<option selected="selected" value="'ROBBERY'">Robbery</option>
						<option selected="selected" value="'SEX OFFENSE - FORCIBLE'">Sex Offense (Forcible)</option>
						<option selected="selected" value="'SEX OFFENSE - NON-FORCIBLE'">Sex Offense (Non-Forcible)</option>
						<option selected="selected" value="'THEFT'">Theft</option>
						<option value="'UNKNOWN'">Unknown</option>
						<option selected="selected" value="'VANDALISM'">Vandalism</option>
						<option selected="selected" value="'WEAPON VIOLATIONS'">Weapon Violations</option>
					</select>
					<p style="width:100%; text-align:right; font-style:italic; font-weight:bold;">ctrl/&#8984; + click to select multiple</p>
				</div>
				<div class="filter-field">
					<input type="submit" value="Submit" id="submitButton">
				</div>
			</div>
		</aside>
		<aside id="vis">
			<h2 class="graph-toggle">Incident Chart</h2>
			<div id="graph"></div>
		</aside>
		<aside id="info-modal" style="display:none;" title="More information">
			<div id="info-sections">
				<h3><a href="#">About the project</a></h3>
				<div>
					<p>This visualization represents security incidents reported on the University of Puget Sound campus. Incidents are broken up by the <a href="http://en.wikipedia.org/wiki/Clery_Act">Clery Act's</a> crime statistics categories, and can be filtered based based on the date and time they occurred. The user is also able to display data from a database of randomly generated incidents.</p>
					<p>The project was created as part of Scott Dunham's CS460 senior project. It is hoped that a tool such as this would be of use to Puget Sound's security staff in analyzing their security incident data.</p>
				</div>
				<h3><a href="#">System requirements</a></h3>
				<div>
					<p>This visualization utilizes modern web technologies, and is best viewed using a modern web browser. Supported browsers include the most current versions of Chrome, Firefox, Opera, Safari, and Internet Explorer 9 (or greater).</p>
				</div>
				<h3><a href="#">Using the visualization</a></h3>
				<div>
					<p><strong>Filtering Displayed Incidents:</strong></p>
					<p>The displayed incidents can be filtered using the controls in the "Filter Incident Data" pane, located at the bottom of the screen. You can toggle the controls by clicking on the pane's title. When clicked, the date and time range fields will display special tools which will help the user make their selection.</p>
					<p><strong>Viewing the Incident Chart:</strong></p>
					<p>A chart of all the visible incidents is available in the "Incident Chart" pane, located at the bottom of the screen next to the filter pane (or at the top of the screen on mobile devices). You can toggle the pane by clicking on it's title.</p>
					<p><strong>Viewing Individual Incident Details:</strong></p>
					<p>Incident markers are automatically grouped into color-coded clusters <em>(green = 2 - 9 incidents, yellow = 10 - 99 incidents, orange = 100 or more incidents)</em>. Hovering over these clusters will reveal a polygon marking the area it's markers cover. Clicking on them will zoom the map if possible, or reveal the markers it represents. Clicking on a marker will reveal a popup with the revelvant incident data.</p>
				</div>
				<h3><a href="#">Why is there fake data?</a></h3>
				<div>
					<p><strong>The fake data was originally created as a placeholder before the actual Security Services data could be obtained, but was kept for a couple of reasons:</strong></p>
					<p>First, it illustrates a small issue with the data collection process for the real incidents. This data is associated with a specific location (e.g. a building, a street, a parking lot), and not necessarily the actual location of the incident. As a result, the real incident data appears highly clustered when it is placed on a map. The fake data set shows what the visualization would look like if the incidents were more evenly distributed.</p>
					<p>Second, the fake data set shows that the source data for this visualization can be updated on a regular and automatic basis (new data points are generated every night, which are immediately viewable in the visualization). There is currently not an automatic link to the real incident data due to security restrictions, though this could easily be addressed by someone with a high level of access to the source database.</p>
				</div>
				<h3><a href="#">Attribution</a></h3>
				<div>
					<p>The following technologies were used in the creation of this visualization:</p>
					<p><strong>Map Components:</strong></p>
					<ul>
						<li><a href="http://leafletjs.com/">Leaflet</a></li>
						<li><a href="http://www.openstreetmap.org/">Open Street Map tiles</a></li>
						<li><a href="http://maps.cloudmade.com/editor">Cloudmade Map Styles</a></li>
						<li><a href="https://github.com/danzel/Leaflet.markercluster">Leaflet.markercluster</a></li>
					</ul>
					<p><strong>Chart Component:</strong></p>
					<ul>
						<li><a href="https://developers.google.com/chart/">Google Chart Tools</a></li>
					</ul>
					<p><strong>User Interface Components:</strong></p>
					<ul>
						<li><a href="http://jqueryui.com/">jQuery UI Widgets</a></li>
						<li><a href="http://fgelinas.com/code/timepicker/">Timepicker jQuery UI Plugin</a></li>
					</ul>
					<p><strong>Icons:</strong></p>
					<ul>
						<li><a href="http://thenounproject.com/noun/question/#icon-No6165" target="_blank">Question</a> designed by <a href="http://thenounproject.com/tlb" target="_blank">Thomas Le Bas</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/flask/#icon-No1725" target="_blank">Flask</a> designed by <a href="http://thenounproject.com/jsoderberg91" target="_blank">Julia Soderberg</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/robbery/#icon-No4270" target="_blank">Robbery</a> designed by <a href="http://thenounproject.com/ochaavmu" target="_blank">United Nations OCHA</a></li>
						<li><a href="http://thenounproject.com/noun/robbery/#icon-No4270" target="_blank">Assault</a> (used as manslaughter) designed by <a href="http://thenounproject.com/ochaavmu" target="_blank">United Nations OCHA</a></li>
						<li><a href="http://thenounproject.com/noun/ski-mask/#icon-No5281" target="_blank">Ski Mask</a> designed by <a href="http://thenounproject.com/United%20Unknown" target="_blank">United Unknown</a></li>
						<li><a href="http://thenounproject.com/noun/murder/#icon-No4269" target="_blank">Murder</a> designed by <a href="http://thenounproject.com/ochaavmu" target="_blank">United Nations OCHA</a></li>
						<li><a href="http://thenounproject.com/noun/forced-recruitment/#icon-No4265" target="_blank">Forced Recruitment</a> (used as sex offense) designed by <a href="http://thenounproject.com/ochaavmu" target="_blank">United Nations OCHA</a></li>
						<li><a href="http://thenounproject.com/noun/car/#icon-No996" target="_blank">Car</a> designed by <a href="http://thenounproject.com/Jeremy" target="_blank">Geremy Good</a></li>
						<li><a href="http://thenounproject.com/noun/pill/#icon-No382" target="_blank">Pill</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/gun/#icon-No138" target="_blank">Gun</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/pickpocket/#icon-No1368" target="_blank">Pickpocket</a> designed by <a href="http://thenounproject.com/PKG" target="_blank">Proletkult Graphik</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/arrest/#icon-No4259" target="_blank">Arrest</a> (used as attempted crime) designed by <a href="http://thenounproject.com/ochaavmu" target="_blank">United Nations OCHA</a></li>
						<li><a href="http://thenounproject.com/noun/hit/#icon-No6593" target="_blank">Hit</a> (used as assault) designed by <a href="http://thenounproject.com/ezy" target="_blank">Ezra Keddell</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/information/#icon-No5745" target="_blank">Information</a> designed by <a href="http://thenounproject.com/kaduma" target="_blank">David Cadusseau</a> from The Noun Project</li>
					</ul>
				</div>
			</div>â€‹
		</aside>
		<section id="map"></section>
	</body>
</html>